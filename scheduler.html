<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Scheduler</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      padding: 2.5rem;
      max-width: 600px;
      animation: fadeIn 1s ease-in-out;
    }
    h2 {
      color: #2d3436;
      text-align: center;
      margin-bottom: 2rem;
      font-weight: 600;
    }
    .form-label {
      font-weight: 500;
      color: #636e72;
      margin-bottom: 0.5rem;
    }
    .form-control {
      border-radius: 10px;
      border: 2px solid #ddd;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    .form-control:focus {
      border-color: #0984e3;
      box-shadow: 0 0 0 0.2rem rgba(9, 132, 227, 0.25);
    }
    .btn-primary {
      background: linear-gradient(45deg, #0984e3, #74b9ff);
      border: none;
      border-radius: 25px;
      padding: 0.75rem 2rem;
      font-weight: 500;
      transition: transform 0.3s, box-shadow 0.3s;
      width: 100%;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(9, 132, 227, 0.3);
    }
    #scheduleOut {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 10px;
      padding: 1rem;
      font-family: 'Courier New', monospace;
      color: #495057;
      white-space: pre-wrap;
      word-wrap: break-word;
      min-height: 150px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>

  <!-- ðŸ”¥ Firebase v8 + Firestore + our init -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="firebase-init.js"></script>
</head>
<body class="p-4">
  <div class="container">
    <h2><i class="bi bi-calendar-event text-primary"></i> Adaptive Study Scheduler</h2>
    <div class="mb-3">
      <label for="stressIn" class="form-label"><i class="bi bi-brain"></i> Stress Score (0-100)</label>
      <input id="stressIn" class="form-control" type="number" value="50" min="0" max="100"/>
    </div>
    <div class="mb-3">
      <label for="hoursIn" class="form-label"><i class="bi bi-clock"></i> Hours available today</label>
      <input id="hoursIn" class="form-control" type="number" value="3" min="0" step="0.5"/>
    </div>
    <button id="genBtn" class="btn btn-primary mt-3"><i class="bi bi-gear"></i> Generate</button>
    <div class="mt-3">
      <label class="form-label"><i class="bi bi-list-check"></i> Generated Schedule:</label>
      <pre id="scheduleOut" class="mt-2"></pre>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Function to generate the adaptive study schedule
    function generateSchedule(stress, hours) {
      let blocks = [];
      let sessionLength, breakLength;

      // Adjust session and break lengths based on stress level
      if (stress > 70) {
        // High stress: shorter sessions, more frequent breaks
        sessionLength = 25; // minutes
        breakLength = 10; // minutes
      } else if (stress > 30) {
        // Moderate stress: medium sessions
        sessionLength = 50;
        breakLength = 15;
      } else {
        // Low stress: longer sessions
        sessionLength = 90;
        breakLength = 20;
      }

      let totalMinutes = hours * 60;
      let currentTime = 0;

      // Generate blocks until time is up
      while (currentTime < totalMinutes) {
        // Add a study block if there's enough time
        if (currentTime + sessionLength <= totalMinutes) {
          blocks.push({ type: 'Study', duration: sessionLength + ' minutes' });
          currentTime += sessionLength;

          // Add a break if there's enough time left
          if (currentTime + breakLength <= totalMinutes) {
            blocks.push({ type: 'Break', duration: breakLength + ' minutes' });
            currentTime += breakLength;
          }
        } else {
          // Add a partial study block for remaining time
          let remaining = totalMinutes - currentTime;
          blocks.push({ type: 'Study', duration: remaining + ' minutes' });
          currentTime = totalMinutes;
        }
      }

      return blocks;
    }

    // Event listener for the generate button
    document.getElementById('genBtn').addEventListener('click', () => {
      const s = Number(document.getElementById('stressIn').value);
      const h = Number(document.getElementById('hoursIn').value);

      // Validate inputs
      if (isNaN(s) || s < 0 || s > 100) {
        alert('Please enter a valid stress score between 0 and 100.');
        return;
      }
      if (isNaN(h) || h < 0) {
        alert('Please enter a valid number of hours (0 or more).');
        return;
      }

      const blocks = generateSchedule(s, h);

      // Format the output as a readable schedule
      let output = '';
      blocks.forEach((block, index) => {
        output += `${index + 1}. ${block.type}: ${block.duration}\n`;
      });

      document.getElementById('scheduleOut').innerText =
        output || 'No schedule generated. Please check your inputs.';

      // Save to localStorage for dashboard integration
      const studyData = {
        time: new Date().toLocaleString(),
        stressScore: s,
        hoursAvailable: h,
        plan: output
      };
      localStorage.setItem("studentverse_scheduler", JSON.stringify(studyData));

      // âœ… Save to Firestore if available
      if (window.saveStudyPlan) {
        window.saveStudyPlan(studyData);
      }
    });
  </script>
</body>
</html>
